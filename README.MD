# sload 

An ASP.NET Core SignalR load testing utility.

## Introduction

**sload**, or formerly known as **SignalRStresser** is a load testing utility designed to work in a distributed manner. Basically a master node invokes many tests on several agents, and these agents will perform the tests, and report back the results to the master.

If you have a server, and want to be able to test a bunch of concurrent connections to the SignalR hub hosted on it, you can use sload's load testing capabilities to see if the correct amount of virtual, or physical resources have been provisioned for it.

This project also comes with a `TestHub` project so that if desired, one can load a simple hub on the server to verify if everything is working correctly. Or, you can use it to actually apply the load test.

This has been used extensively to test not only direct connections to a native hub on a physical server, but also has been used to test the [Azure SignalR service](https://azure.microsoft.com/en-us/services/signalr-service/) to measure the relative performance between self-hosted backplane infrastructure as opposed to a cloud-based one.

## Usage

The application itself is quite straightforward. It is a command line application with most of the options defined within the source code itself. 

Here's how to get started quickly...

To initiate an agent, or agents:

```
.\sload --isMasterNode false --agentNodeHostnames yourAgentHostname --masterNodeHostName localhost
```

The agent will then begin to listen on port 9999 by default.

To initiate a master, run another instance of the program locally, or remotely defining the hostnames of the agent. For example, to provision 5000 connections to 2 agents:

```
.\sload --maxConnections 2500 --agentNodeHostnames agent1,agent2 --masterNodeHostName localhost --hubUrl https://localhost:5001/hub
```

2500 connections will then be generated by `agent1` and `agent2` for a total of 5000 connections to `https://localhost:5001/hub`.

When the tests are complete, sload generates a report similar to the following, so you can parse and analyze later:

```
{
	"runParameters": [{
		"workerId": 0,
		"successfulConnections": 31736,
		"faultedConnections": 0,
		"disconnectedConnections": 500,
		"runParameters": {
			"maxConnections": 500,
			"hubUrl": "https://localhost:5001/hub",
			"outputDirectory": "C:\\SignalRStresser\\SignalRStresser\\bin\\Release\\netcoreapp2.2\\sload_results\\",
			"persistConnectionTime": 600,
			"persistConnectionInterval": 30000,
			"persistConnectionPayloadSize": 2048,
			"numberOfCpus": 8,
			"workers": 2,
			"workerId": 0,
			"rampUpInterval": 1500,
			"pingInterval": 10000,
			"pingSize": 1,
			"keepAliveInterval": 2000,
			"handshakeTimeout": 60000,
			"serverTimeout": 120000
		},
		"benchmarkState": 5
	}, {
		"workerId": 1,
		"successfulConnections": 31273,
		"faultedConnections": 0,
		"disconnectedConnections": 500,
		"runParameters": {
			"maxConnections": 500,
			"hubUrl": "https://localhost:5001/hub",
			"outputDirectory": "C:\\SignalRStresser\\SignalRStresser\\bin\\Release\\netcoreapp2.2\\sload_results\\",
			"persistConnectionTime": 600,
			"persistConnectionInterval": 30000,
			"persistConnectionPayloadSize": 2048,
			"numberOfCpus": 8,
			"workers": 1,
			"workerId": 1,
			"rampUpInterval": 1500,
			"pingInterval": 10000,
			"pingSize": 1,
			"keepAliveInterval": 2000,
			"handshakeTimeout": 60000,
			"serverTimeout": 120000
		},
		"benchmarkState": 5
	}],
	"errorLogs": [
		[],
		[]
	],
	"callTimes": [{
		"workerId": 0,
		"times": [49, 22, 38, 37, 21, 21, 20, 22, 54, 47, 40, 18, 37, 24, 48, 23, 37, 38, 23, 32, 17, 43, 33, 20, 38, 43, 51, 23, 20, 40, 21, 32, 21, 24, 18, 23, 17, 15, 35, 37, 21, 39, 49, 23, 22, 17, 48, 19, 42, 19, 18, 56, 32, 38, 39, 29, 36, 41, 38, 35, 23, 56, 24, 52, 20, 21, 20, 49, 48, 49, 20, 44, 22, 20, 48, 31, 20, 22, 32, 21, 18, 35, 19, 49, 37, 37, 46, 23, 47, 41, 22, 17, 46, 39, 19, 19, 20, 19, 22, 34, 29, 32, 31, 38, 16, 32, 39, 16, 23, 22, 31, 37, 39, 40, 43, 22, 20, 44, 17, 31, 24, 56, 23, 34, 24, 21, 23, 53, 21, 20, 42, 19, 51, 34, 21, 43, 20, 20, 16, 20, 21, 22, 20, 48, 37, 23, 23, 32, 17, 21, 43, 35, 50, 35, 20, 32, 21, 38, 29, 19, 45, 31, 32, 36, 43, 17, 23, 17, 21, 39, 35, 43, 32, 50, 37, 46, 34, 40, 28, 25, 41, 20, 41, 31, 25, 39, 20, 19, 17, 20, 18, 18, 22, 22, 24, 34, 20, 18, 46, 19, 34, 23, 33, 42, 41, 45, 33, 20, 26, 29, 24, 38, 37, 38, 35, 26, 31, 34, 20, 46, 41, 17, 38, 43, 28, 21, 32, 39, 36, 42, 30, 22, 17, 21, 17, 31, 24, 23, 34, 56, 25, 33, 39, 31, 39, 32, 18, 42, 44, 22, 18, 21, 20, 22, 20, 44, 15, 24, 30, 40, 51, 23, 18, 21, 50, 43, 35, 23, 48, 21, 37, 36, 21, 34, 38, 24, 19, 35, 47, 45, 24, 19, 18, 32, 36, 21, 57, 40, 42, 32, 42, 32, 22, 26, 32, 50, 37, 23, 35, 51, 42, 16, 34, 20, 42, 27, 39, 22, 48, 24, 44, 20, 22, 20, 20, 22, 42, 20, 43, 16, 23, 21, 23, 21, 27, 24, 19, 21, 54, 23, 50, 44, 20, 23, 44, 32, 20, 19, 39, 34, 20, 35, 35, 36, 41, 46, 34, 32, 38, 38, 38, 25, 19, 25, 43, 20, 23, 31, 35, 23, 22, 34, 21, 31, 42, 38, 41, 23, 34, 40, 43, 38, 20, 24, 21, 22, 21, 24, 49, 47, 18, 18, 48, 53, 48, 47, 41, 23, 18, 38, 46, 22, 36, 21, 31, 45, 41, 34, 21, 38, 21, 43, 41, 41, 40, 36, 36, 37, 42, 44, 19, 31, 20, 38, 22, 35, 22, 39, 46, 32, 41, 22, 38, 22, 17, 37, 25, 43, 40, 31, 43, 25, 26, 32, 42, 40, 42, 22, 27, 51, 19, 38, 17, 20, 23, 31, 23, 42, 38, 57, 52, 37, 57, 23, 34, 37, 48, 37, 21, 42, 21, 32, 39, 38, 39, 33, 42, 25, 47, 32, 46, 21, 40, 19, 26, 56, 34, 38, 30, 31, 19, 20, 22, 45, 31, 22, 47, 26, 31, 34, 25, 25, 46, 56, 20, 32, 35, 43, 47, 25]
	}, {
		"workerId": 1,
		"times": [27, 22, 19, 18, 19, 18, 18, 22, 27, 24, 26, 27, 19, 22, 24, 27, 26, 22, 29, 22, 28, 20, 23, 30, 23, 24, 19, 25, 25, 18, 24, 24, 25, 19, 20, 20, 25, 25, 24, 25, 23, 21, 25, 23, 16, 20, 22, 21, 18, 29, 24, 20, 25, 24, 22, 23, 28, 20, 23, 28, 27, 28, 24, 27, 19, 20, 19, 20, 26, 21, 30, 20, 28, 21, 20, 27, 24, 21, 26, 22, 19, 20, 20, 23, 25, 17, 23, 19, 26, 18, 29, 27, 18, 20, 19, 25, 24, 28, 23, 24, 24, 25, 22, 27, 23, 31, 21, 28, 25, 24, 32, 23, 27, 24, 28, 27, 27, 26, 28, 24, 23, 22, 28, 27, 33, 22, 20, 29, 18, 25, 22, 23, 21, 20, 22, 24, 26, 28, 28, 20, 17, 27, 24, 24, 29, 17, 23, 24, 23, 23, 25, 23, 26, 21, 24, 26, 23, 21, 23, 26, 31, 27, 25, 23, 23, 22, 27, 27, 23, 25, 23, 31, 28, 24, 28, 30, 23, 28, 26, 30, 21, 27, 32, 22, 24, 27, 24, 18, 22, 20, 20, 20, 21, 21, 20, 27, 26, 22, 23, 28, 26, 26, 29, 27, 21, 26, 24, 24, 25, 24, 24, 19, 25, 23, 24, 23, 24, 21, 20, 26, 23, 27, 23, 23, 24, 21, 30, 19, 25, 27, 26, 25, 24, 23, 26, 23, 21, 21, 23, 21, 20, 28, 24, 24, 30, 20, 19, 24, 25, 27, 22, 18, 24, 17, 29, 26, 23, 26, 22, 25, 22, 28, 20, 26, 23, 23, 28, 26, 23, 20, 24, 21, 23, 23, 26, 26, 24, 26, 25, 20, 21, 27, 20, 22, 24, 27, 24, 28, 24, 31, 24, 27, 31, 24, 22, 24, 19, 20, 29, 24, 21, 28, 27, 27, 26, 23, 27, 28, 30, 23, 21, 29, 29, 22, 24, 24, 23, 27, 32, 19, 21, 21, 22, 23, 28, 22, 20, 27, 29, 20, 27, 20, 28, 28, 29, 23, 30, 25, 24, 31, 22, 30, 28, 25, 16, 31, 31, 28, 31, 20, 27, 26, 25, 23, 29, 28, 23, 29, 18, 27, 27, 21, 23, 25, 26, 23, 27, 28, 27, 30, 28, 29, 20, 19, 20, 19, 28, 23, 16, 27, 20, 22, 21, 27, 23, 20, 27, 20, 21, 30, 29, 22, 27, 25, 21, 23, 31, 21, 24, 28, 24, 24, 24, 23, 20, 28, 26, 25, 23, 26, 23, 24, 24, 16, 22, 24, 20, 28, 21, 24, 28, 30, 18, 27, 19, 28, 27, 27, 21, 20, 31, 28, 27, 21, 20, 20, 20, 20, 23, 21, 23, 22, 23, 20, 26, 27, 20, 24, 26, 21, 22, 22, 29, 22, 20, 24, 20, 29, 28, 20, 22, 20, 22, 21, 24, 22, 23, 24, 29, 24, 21, 24, 25, 28, 25, 27, 25, 31, 25, 30, 23, 28, 22, 23, 27, 23, 22, 28, 26, 23, 18, 23, 28, 27, 24, 28, 30, 26, 24, 28]
	}],
	"callStatistics": {
		"successfulConnections": 63009,
		"disconnectedConnections": 1000,
		"faultedConnections": 0,
		"average": 27.0,
		"p50": 25,
		"p90": 42,
		"p95": 46,
		"p99": 54,
		"fast": 1.0,
		"acceptable": 0.0,
		"slow": 0.0,
		"xslow": 0.0
	},
	"reconnectResults": []
}
```

## Scale

* I have been able to generate 150,000 concurrent connections with caller-to-caller latency tests with sload.
* The platform that was heavily tested was using the Azure SignalR service.
